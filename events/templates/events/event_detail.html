{% extends 'base.html' %}
{% load custom_tags %}

{% block title %}
  {{ event.name }}
{% endblock %}

{% block content %}
  <div class="bg-white rounded shadow p-4">
    <div class="grid md:grid-cols-2 gap-4">
      <img src="{{ event.image.url }}" class="w-full rounded" />
      <div>
        <h1 class="text-2xl font-semibold mb-2">{{ event.name }}</h1>
        <p class="text-gray-600 mb-1">{{ event.category.name }}</p>
        <p class="text-gray-600 mb-1">{{ event.date }} {{ event.time }}</p>
        <p class="text-gray-600 mb-1">Location: {{ event.location }}</p>
        <p class="mb-3">{{ event.description }}</p>

        {% if user.is_authenticated %}
          {% if user_has_rsvped %}
            <span class="inline-block px-3 py-1 bg-green-100 rounded">You have RSVP’d</span>
          {% else %}
            <a href="{% url 'rsvp_event' event.id %}" class="px-4 py-2 bg-blue-600 text-white rounded">RSVP</a>
          {% endif %}

          {% if user.is_superuser or user|has_group:'Admin,Organizer' %}
            <div class="mt-3 space-x-2">
              <a href="{% url 'event_edit' event.id %}" class="px-3 py-1 bg-amber-600 text-white rounded">Edit</a>
              <form method="post" action="{% url 'event_delete' event.id %}" class="inline">
                {% csrf_token %}
                <button class="px-3 py-1 bg-red-600 text-white rounded">Delete</button>
              </form>
            </div>
          {% endif %}
        {% else %}
          <p class="text-sm text-gray-600">Login to RSVP.</p>
        {% endif %}
      </div>
    </div>

    <h3 class="mt-6 font-semibold">Participants</h3>
    <ul class="list-disc pl-5">
      {% for r in event.rsvps.all %}
        <li>{{ r.user.get_full_name|default:r.user.username }}</li>
      {% empty %}
        <li>No one RSVP’d yet.</li>
      {% endfor %}
    </ul>
  </div>
{% endblock %}
